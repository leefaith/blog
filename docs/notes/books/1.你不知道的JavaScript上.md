## 1.作用域是什么

存储变量，并对其访问或修改

### 1.1 编译原理

JavaScript 归类为“动态”或“解释执行”语言

它不是提前编译的，编译结果也不能在分布式系统中进行移植。

#### 1.分词/词法分析

**分词（tokenizing）**：字符组成的字符串分解成有意义的代码块，这些代码块被称为词法单元（token）。

var a = 2;分解成为下面这些词法单元：var、a、=、2 、;

**词法分析**（Lexing）： 词法单元生成器在判断 a 是一个独立的词法单元还是其他词法 单元的一部分时，调用的是有状态的解析规则。

#### 2.解析/语法分析（Parsing）

**抽象语法树（Abstract Syntax Tree，AST）**将词法单元流（数组）转换成一个由元素逐级嵌套所组成的代表了程序语法结构的树。

#### 3.代码生成

**代码生成：**AST 转换为可执行代码的过程

创建一个叫作 a 的变量（包括分配内存等），并将一个值储存在 a 中。

简单地说，任何 JavaScript 代码片段在执行前都要进行编译（通常就在执行前）。因此 JavaScript 编译器首先会对 var a = 2; 这段程序进行编译，然后做好执行它的准备，并且通常马上就会执行它。 

### 1.2 理解作用域 

**引擎**  JavaScript 程序的编译及执行过程。

**编译器** 负责语法分析及代码生成

**作用域** 收集并维护由所有声明的标识符（变量）组成的一系列查 询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限。



变量的赋值操作会执行两个动作，首先**编译器**会在当前<u>作用域</u>中**声明一个变量**（如 果之前没有声明过），然后在运行时**引擎**会在<u>作用域</u>中**查找该变量**，如果能够找到就会对它赋值。

当变量出现在赋值操作的左侧时进行 LHS 查询，出现在右侧时进行 RHS 查询。

RHS **找值** 

LHS **赋值**

### 1.3 作用域嵌套 

当一个块或函数嵌套在另一个块或函数中时，就发生了作用域的嵌套

引擎从当前的执行作用域开始查找变量，如果找不到， 就向上一级继续查找。当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都会停止。 

### 1.4 异常

RHS 查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛ReferenceError 异常。

ReferenceError 同作用域判别失败相关，而 TypeError 则代表作用域判别成功了，但是对 结果的操作是非法或不合理的

不成功的 LHS 引用会导致自动隐式 地创建一个全局变量（非严格模式下），该变量使用 LHS 引用的目标作为标识符，或者抛 出 ReferenceError 异常（严格模式下）。 

### 1.5 小结

作用域是一套==规则==，用于确定在何处以及如何查找变量（标识符）。如果查找的目的是对变量进行赋值，那么就会使用 LHS 查询；如果目的是获取变量的值，就会使用 RHS 查询。

## 2.词法作用域 

### 2.1 词法阶段

